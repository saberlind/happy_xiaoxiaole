name: Deploy to GitHub Pages

# è§¦å‘æ¡ä»¶
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

# è®¾ç½®æƒé™
permissions:
  contents: write

# ç¡®ä¿åŒæ—¶åªæœ‰ä¸€ä¸ªéƒ¨ç½²åœ¨è¿è¡Œ
concurrency:
  group: "gh-pages"
  cancel-in-progress: false

jobs:
  # æ„å»ºä½œä¸š
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ è®¾ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        if [ -f package-lock.json ]; then
          npm ci
        else
          npm install
        fi
        
    - name: ğŸ—ï¸ æ„å»ºé¡¹ç›®
      run: |
        # å¦‚æœæ²¡æœ‰buildè„šæœ¬ï¼Œç›´æ¥å¤åˆ¶æ–‡ä»¶
        if npm run build 2>/dev/null; then
          echo "âœ… ä½¿ç”¨npmæ„å»ºå®Œæˆ"
        else
          echo "ğŸ“ ç›´æ¥å¤åˆ¶æ–‡ä»¶åˆ°distç›®å½•"
          mkdir -p dist
          cp index.html dist/
          cp styles.css dist/
          cp game.js dist/
          echo "âœ… æ–‡ä»¶å¤åˆ¶å®Œæˆ"
        fi
        
        # æ·»åŠ .nojekyllæ–‡ä»¶é¿å…Jekyllå¤„ç†
        touch dist/.nojekyll
        echo "ğŸ“„ å·²æ·»åŠ .nojekyllæ–‡ä»¶"
        
    - name: ğŸ“‹ éªŒè¯æ„å»ºç»“æœ
      run: |
        echo "ğŸ“Š æ„å»ºç›®å½•å†…å®¹:"
        ls -la dist/
        echo "ğŸ“ æ–‡ä»¶å¤§å°:"
        du -h dist/*
        
    - name: ğŸš€ éƒ¨ç½²åˆ° GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./dist
        publish_branch: gh-pages
        
    - name: ğŸ‰ éƒ¨ç½²å®Œæˆé€šçŸ¥
      run: |
        echo "âœ… éƒ¨ç½²æˆåŠŸï¼"
        echo "ğŸŒ ç½‘ç«™å°†åœ¨å‡ åˆ†é’Ÿåå¯ç”¨"
        echo "â° æ›´æ–°å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ç”Ÿæ•ˆ"